<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stories Maker 9:16</title>

<style>
body{
  margin:0;
  background:#0b0c10;
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  text-align:center;
}
.wrap{
  max-width:420px;
  margin:20px auto;
  padding:16px;
}
textarea{
  width:100%;
  height:120px;
  border-radius:12px;
  border:none;
  padding:12px;
  font-size:16px;
}
input[type="file"]{
  margin:10px 0;
}
button{
  padding:12px 20px;
  border-radius:12px;
  border:none;
  background:#2a6df5;
  color:#fff;
  font-size:16px;
  margin-top:10px;
  cursor:pointer;
}
canvas{
  width:100%;
  border-radius:18px;
  margin-top:16px;
}
.small{
  opacity:.6;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>
<body>

<div class="wrap">
  <h2>Stories Generator 9:16</h2>

  <input type="file" id="imageInput" accept="image/*">
  <textarea id="textInput" placeholder="Введите текст..."></textarea>
  <button onclick="generate()">Создать</button>

  <canvas id="canvas" width="1080" height="1920"></canvas>
  <div class="small">Сохранение: долгий тап по картинке</div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function generate(){
  const file = document.getElementById("imageInput").files[0];
  const text = document.getElementById("textInput").value;

  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    const img = new Image();
    img.onload = function(){

      const W = canvas.width;
      const H = canvas.height;

      ctx.clearRect(0,0,W,H);

      // ---- Масштабирование изображения 9:16 ----
      const scale = Math.max(W / img.width, H / img.height);
      const x = (W - img.width * scale) / 2;
      const y = (H - img.height * scale) / 2;

      ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

      // ---- Instagram-style градиент ----
      const gradientHeight = 700;
      const gradient = ctx.createLinearGradient(0, H - gradientHeight, 0, H);
      gradient.addColorStop(0, "rgba(0,0,0,0)");
      gradient.addColorStop(1, "rgba(0,0,0,0.65)");

      ctx.fillStyle = gradient;
      ctx.fillRect(0, H - gradientHeight, W, gradientHeight);

      // ---- Текст ----
      const sidePadding = 120;
      const bottomOffset = 100; // меняй 80-140 если нужно ниже/выше
      const maxWidth = W - sidePadding * 2;

      ctx.font = "bold 72px system-ui";
      ctx.fillStyle = "#ffffff";
      ctx.textAlign = "left";

      // перенос строк
      const words = text.split(" ");
      let lines = [];
      let currentLine = "";

      for (let word of words){
        const testLine = currentLine + word + " ";
        const metrics = ctx.measureText(testLine);
        if(metrics.width > maxWidth && currentLine !== ""){
          lines.push(currentLine);
          currentLine = word + " ";
        } else {
          currentLine = testLine;
        }
      }
      lines.push(currentLine);

      const lineHeight = 88;
      const blockH = lines.length * lineHeight;
      const topY = H - blockH - bottomOffset;

      for(let i=0;i<lines.length;i++){
        ctx.fillText(lines[i], sidePadding, topY + i*lineHeight);
      }

    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
